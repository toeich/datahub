package de.jworks.datahub.presentation.admin;

import javax.servlet.ServletException;

import com.vaadin.annotations.AutoGenerated;
import com.vaadin.cdi.access.JaasAccessControl;
import com.vaadin.event.ShortcutAction.KeyCode;
import com.vaadin.server.Page;
import com.vaadin.ui.Alignment;
import com.vaadin.ui.Button;
import com.vaadin.ui.Button.ClickEvent;
import com.vaadin.ui.Button.ClickListener;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.HorizontalLayout;
import com.vaadin.ui.Label;
import com.vaadin.ui.PasswordField;
import com.vaadin.ui.TextField;
import com.vaadin.ui.VerticalLayout;

public class LoginView extends CustomComponent {

	/*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */

	@AutoGenerated
	private VerticalLayout mainLayout;
	@AutoGenerated
	private VerticalLayout loginPanel;
	@AutoGenerated
	private HorizontalLayout loginForm;
	@AutoGenerated
	private Button signInButton;
	@AutoGenerated
	private PasswordField passwordField;
	@AutoGenerated
	private TextField usernameField;
	@AutoGenerated
	private HorizontalLayout labels;
	@AutoGenerated
	private Label label_2;
	@AutoGenerated
	private Label label_1;
	
	public LoginView() {
		buildMainLayout();
		setCompositionRoot(mainLayout);

		// TODO add user code here
		signInButton.addClickListener(new ClickListener() {
			@Override
			public void buttonClick(ClickEvent event) {
				try {
					JaasAccessControl.login(usernameField.getValue(), passwordField.getValue());
					Page.getCurrent().reload();
				} catch (ServletException e) {
					label_2.setValue(e.getMessage());
				}
			}
		});
		signInButton.setClickShortcut(KeyCode.ENTER);
		
		usernameField.focus();
	}

	@AutoGenerated
	private VerticalLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new VerticalLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("100%");
		mainLayout.setHeight("100%");
		mainLayout.setMargin(false);
		
		// top-level component properties
		setWidth("100.0%");
		setHeight("100.0%");
		
		// loginPanel
		loginPanel = buildLoginPanel();
		mainLayout.addComponent(loginPanel);
		mainLayout.setComponentAlignment(loginPanel, new Alignment(48));
		
		return mainLayout;
	}

	@AutoGenerated
	private VerticalLayout buildLoginPanel() {
		// common part: create layout
		loginPanel = new VerticalLayout();
		loginPanel.setStyleName("blue");
		loginPanel.setImmediate(false);
		loginPanel.setWidth("500px");
		loginPanel.setHeight("-1px");
		loginPanel.setMargin(true);
		loginPanel.setSpacing(true);
		
		// labels
		labels = buildLabels();
		loginPanel.addComponent(labels);
		
		// loginForm
		loginForm = buildLoginForm();
		loginPanel.addComponent(loginForm);
		
		return loginPanel;
	}

	@AutoGenerated
	private HorizontalLayout buildLabels() {
		// common part: create layout
		labels = new HorizontalLayout();
		labels.setImmediate(false);
		labels.setWidth("100.0%");
		labels.setHeight("-1px");
		labels.setMargin(false);
		
		// label_1
		label_1 = new Label();
		label_1.setStyleName("h1");
		label_1.setImmediate(false);
		label_1.setWidth("100.0%");
		label_1.setHeight("-1px");
		label_1.setValue("Welcome");
		labels.addComponent(label_1);
		labels.setExpandRatio(label_1, 1.0f);
		labels.setComponentAlignment(label_1, new Alignment(33));
		
		// label_2
		label_2 = new Label();
		label_2.setStyleName("h2");
		label_2.setImmediate(false);
		label_2.setWidth("-1px");
		label_2.setHeight("-1px");
		label_2.setValue("Data Hub // Admin");
		labels.addComponent(label_2);
		labels.setComponentAlignment(label_2, new Alignment(33));
		
		return labels;
	}

	@AutoGenerated
	private HorizontalLayout buildLoginForm() {
		// common part: create layout
		loginForm = new HorizontalLayout();
		loginForm.setImmediate(false);
		loginForm.setWidth("100.0%");
		loginForm.setHeight("-1px");
		loginForm.setMargin(false);
		loginForm.setSpacing(true);
		
		// usernameField
		usernameField = new TextField();
		usernameField.setCaption("Username");
		usernameField.setImmediate(false);
		usernameField.setWidth("100.0%");
		usernameField.setHeight("-1px");
		loginForm.addComponent(usernameField);
		loginForm.setExpandRatio(usernameField, 1.0f);
		loginForm.setComponentAlignment(usernameField, new Alignment(9));
		
		// passwordField
		passwordField = new PasswordField();
		passwordField.setCaption("Password");
		passwordField.setImmediate(false);
		passwordField.setWidth("100.0%");
		passwordField.setHeight("-1px");
		loginForm.addComponent(passwordField);
		loginForm.setExpandRatio(passwordField, 1.0f);
		loginForm.setComponentAlignment(passwordField, new Alignment(9));
		
		// signInButton
		signInButton = new Button();
		signInButton.setCaption("Sign In");
		signInButton.setImmediate(false);
		signInButton.setWidth("-1px");
		signInButton.setHeight("-1px");
		loginForm.addComponent(signInButton);
		loginForm.setComponentAlignment(signInButton, new Alignment(9));
		
		return loginForm;
	}

}
